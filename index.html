<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«ÙÙ€Ù€Ù€Ø± | ATHAR LEGACY</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', Tahoma, sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; display: flex; justify-content: center; align-items: center;
            transition: opacity 1.2s ease-in-out;
        }
        #welcome-text {
            font-size: 1.6rem; text-align: center; color: #2ecc71;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
            padding: 20px; border-bottom: 2px solid #00f2ff;
            min-width: 300px;
            transition: all 0.5s ease; /* Ù„Ø¥Ø¶Ø§ÙØ© Ù†Ø¹ÙˆÙ…Ø© Ø¹Ù†Ø¯ ØªØºÙŠØ± Ø§Ù„Ù†Øµ */
        }

        .card { 
            background: rgba(10, 30, 20, 0.9); 
            padding: 2.5rem; border-radius: 30px; 
            border: 3px solid #2ecc71; 
            width: 85%; max-width: 380px; 
            z-index: 2; backdrop-filter: blur(15px);
            box-shadow: 0 0 50px rgba(46, 204, 113, 0.5);
            text-align: center; display: none; opacity: 0;
            transition: opacity 0.8s ease;
        }

        h1 { margin: 0; font-size: 3rem; text-shadow: 0 0 20px #2ecc71; color: #fff; font-weight: bold; }
        .tagline { color: #00f2ff; font-size: 0.85rem; letter-spacing: 5px; margin-bottom: 25px; text-shadow: 0 0 10px #00f2ff; }

        .message-box {
            background: rgba(46, 204, 113, 0.15);
            padding: 15px; border-radius: 15px;
            margin-bottom: 20px; border-right: 5px solid #2ecc71;
            font-size: 1rem; line-height: 1.6; color: #fff; text-align: right;
        }

        .info-box { background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 15px; margin: 12px 0; border-right: 5px solid #2ecc71; text-align: right; }
        .info-box strong { color: #00f2ff; display: block; font-size: 0.85rem; margin-bottom: 5px; }
        .info-box span { font-size: 1.2rem; color: #fff; font-weight: 500; }

        .contact-actions { display: flex; gap: 10px; margin-top: 20px; }
        .btn-contact { 
            flex: 1; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; 
            font-size: 1rem; border: none; transition: 0.3s; color: #000;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-call { background: #2ecc71; }
        .btn-wa { background: #25D366; }

        input { width: 100%; padding: 14px; margin: 10px 0; background: rgba(0, 0, 0, 0.5); border: 1px solid #2ecc71; color: #fff; border-radius: 12px; box-sizing: border-box; text-align: right; font-size: 1rem; }
        button#subBtn { width: 100%; padding: 18px; margin-top: 15px; background: linear-gradient(135deg, #2ecc71, #00f2ff); border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: #000; font-size: 1.2rem; }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div id="welcome-text">Ø£Ø«ÙÙ€Ù€Ù€Ø±</div>
</div>

<canvas id="chipCanvas"></canvas>

<div class="card" id="displayCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    <div class="message-box">
        Ù„Ù‚Ø¯ ÙˆØ¬Ø¯ØªÙ <span style="color: #00f2ff; font-weight: bold;">Ø£Ø«Ø±Ø§Ù‹ Ù…ÙÙ‚ÙˆØ¯Ø§Ù‹</span>.. 
        Ø¨Ù…Ø³Ø­Ùƒ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŒ Ø£Ù†Øª Ø§Ù„Ø¢Ù† Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ø¹ÙˆØ¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø«Ø± Ø¥Ù„Ù‰ ØµØ§Ø­Ø¨Ù‡. ÙØ¶Ù„Ø§Ù‹ØŒ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¹Ø§Ø¯ØªÙ‡.
    </div>
    <div class="info-box"><strong>ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø±</strong> <span id="vName"></span></div>
    <div class="contact-actions">
        <button id="callLink" class="btn-contact btn-call">ğŸ“ Ø§ØªØµØ§Ù„</button>
        <button id="waLink" class="btn-contact btn-wa">ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
</div>

<div class="card" id="regCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    <form id="regForm">
        <input type="text" name="name" placeholder="ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø± *" required>
        <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *" required>
        <input type="text" name="itemCode" id="itemCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ *" required>
        <button type="submit" id="subBtn">Ø¨Ø« Ø§Ù„Ø­ÙŠØ§Ø© ÙÙŠ Ø£Ø«Ø±Ùƒ</button>
    </form>
</div>

<script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxxphuMJvEQhUL4D7To3cRodLmXhRV3ngRGr0OwyaZnJo9TX-wPSXXtAujHiJGzaOn8/exec';
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');

    window.onload = () => {
        const welcomeTextEl = document.getElementById('welcome-text');

        if (!code) {
            // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
            welcomeTextEl.innerText = "Ø§ØµÙ†Ø¹ Ø£Ø«Ø±Ø§Ù‹.. ÙŠØ¨Ù‚Ù‰ Ø£Ø¨Ø¯ Ø§Ù„Ø¯Ù‡Ø±";
            finishWelcome(3000);
        } else {
            // Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø«Ø± (Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù…ØªØºÙŠØ±)
            welcomeTextEl.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø±..";
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            fetch(`${webAppUrl}?read=${encodeURIComponent(code)}`)
                .then(res => res.json())
                .then(data => { 
                    window.fetchedData = data;
                    // Ø¨Ù…Ø¬Ø±Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†ØºÙŠØ± Ø§Ù„Ù†Øµ
                    setTimeout(() => {
                        welcomeTextEl.style.opacity = "0";
                        setTimeout(() => {
                            welcomeTextEl.innerText = "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!";
                            welcomeTextEl.style.opacity = "1";
                            welcomeTextEl.style.color = "#00f2ff";
                            finishWelcome(1500); // Ù†Ù†Ù‡ÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ Ø¸Ù‡ÙˆØ± "ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ±"
                        }, 500);
                    }, 1000);
                });
        }
    };

    function finishWelcome(delay) {
        setTimeout(() => {
            const welcome = document.getElementById('welcome-screen');
            welcome.style.opacity = '0';
            setTimeout(() => {
                welcome.style.display = 'none';
                renderResult();
            }, 800);
        }, delay);
    }

    function renderResult() {
        if (!code) { showCard('regCard'); return; }
        const data = window.fetchedData;
        if (data && data.name && data.name !== "Not Found") {
            document.getElementById('vName').innerText = data.name;
            const phone = data.phone;
            document.getElementById('callLink').onclick = () => { window.location.href = `tel:${phone}`; };
            document.getElementById('waLink').onclick = () => { window.location.href = `https://wa.me/${phone}`; };
            showCard('displayCard');
        } else {
            showCard('regCard');
            document.getElementById('itemCode').value = code || '';
        }
    }

    function showCard(id) {
        const el = document.getElementById(id);
        el.style.display = 'block';
        setTimeout(() => { el.style.opacity = '1'; }, 50);
    }

    // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ©
    const canvas = document.getElementById('chipCanvas');
    const ctx = canvas.getContext('2d');
    let w, h, particles = [];
    function init() {
        w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight;
        particles = []; for (let i = 0; i < 70; i++) particles.push(new Particle());
    }
    class Particle {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * w; this.y = Math.random() * h;
            this.v = Math.random() * 1.5 + 0.5;
            this.color = Math.random() > 0.4 ? '#2ecc71' : '#00f2ff';
            this.dir = Math.random() > 0.5 ? 'h' : 'v';
        }
        draw() {
            ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, 2.5, 2.5);
            if (this.dir === 'h') this.x += this.v; else this.y += this.v;
            if (this.x > w || this.y > h) this.reset();
        }
    }
    function animate() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; ctx.fillRect(0, 0, w, h);
        particles.forEach(p => p.draw()); requestAnimationFrame(animate);
    }
    init(); animate();

    document.getElementById('regForm').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('subBtn').innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        fetch(webAppUrl, { method: 'POST', mode: 'no-cors', body: new URLSearchParams(new FormData(this)) })
        .then(() => { alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø«Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­!'); location.reload(); });
    };
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«ÙÙ€Ù€Ù€Ø± | ATHAR LEGACY</title>
    <style>
        :root {
            --primary-color: #2ecc71;
            --secondary-color: #00f2ff;
            --bg-dark: #000000;
            --card-bg: rgba(7, 15, 10, 0.92);
        }

        body { 
            margin: 0; background: var(--bg-dark); color: #fff; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            overflow: hidden; display: flex; justify-content: center; align-items: center; min-height: 100vh; 
            touch-action: none; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ù…Ø³ */
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; display: flex; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-in-out;
        }
        #welcome-text {
            font-size: 1.5rem; text-align: center; color: var(--primary-color);
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
            padding: 15px; border-bottom: 2px solid var(--secondary-color);
            opacity: 0; animation: fadeInOut 2.8s forwards;
        }
        @keyframes fadeInOut { 0% { opacity: 0; transform: scale(0.9); } 30% { opacity: 1; transform: scale(1); } 70% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.05); } }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙˆØ­Ø¯ */
        .card { 
            background: var(--card-bg); 
            padding: 2rem; border-radius: 30px; 
            border: 1px solid rgba(46, 204, 113, 0.4); 
            width: 88%; max-width: 380px; 
            z-index: 2; backdrop-filter: blur(25px);
            box-shadow: 0 0 50px rgba(0, 242, 255, 0.1);
            text-align: center; display: none; opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateY(20px);
        }
        .card.active { display: block; opacity: 1; transform: translateY(0); }

        h1 { margin: 0; font-size: 2.5rem; color: #fff; text-shadow: 0 0 15px var(--primary-color); }
        .tagline { color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 5px; margin-bottom: 20px; opacity: 0.8; }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ø«Ø± */
        .message-box {
            background: rgba(46, 204, 113, 0.07);
            padding: 15px; border-radius: 15px;
            margin-bottom: 20px; border-right: 3px solid var(--primary-color);
            font-size: 0.9rem; line-height: 1.6; text-align: justify;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; margin: 8px 0; padding: 12px;
            text-align: right; position: relative;
        }
        .info-box strong { color: var(--secondary-color); display: block; font-size: 0.7rem; margin-bottom: 3px; }
        .info-box span { font-size: 1.1rem; }

        input {
            width: 100%; box-sizing: border-box; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(46, 204, 113, 0.3); padding: 12px; margin: 8px 0;
            border-radius: 12px; color: #fff; text-align: right; outline: none;
        }

        button { 
            width: 100%; padding: 14px; margin-top: 15px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none; border-radius: 12px; color: #000; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }
        button:active { transform: scale(0.95); }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª */
        .visitor-count { font-size: 0.7rem; color: var(--secondary-color); margin-top: 15px; opacity: 0.6; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµØºÙŠØ±Ø© */
        .controls { position: fixed; bottom: 20px; left: 20px; z-index: 10; display: flex; gap: 10px; }
        .btn-circle { 
            width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1);
            border: 1px solid var(--primary-color); color: #fff; display: flex; 
            justify-content: center; align-items: center; cursor: pointer; font-size: 1rem;
        }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div id="welcome-text">ÙƒÙÙ„ Ù…Ø§ Ù†ØªØ±ÙƒÙ‡Ù Ø®Ù„ÙÙ†Ø§.. ÙŠÙØ­ÙŠÙŠÙ†Ø§</div>
</div>

<canvas id="chipCanvas"></canvas>

<div class="card" id="displayCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    
    <div class="message-box">
        Ù„Ù‚Ø¯ ÙˆØ¬Ø¯ØªÙ Ù‚Ø·Ø¹Ø© ØªØ­Ù…Ù„ <span style="color: var(--secondary-color);">Ø£Ø«Ø±Ø§Ù‹</span>.. 
        ØµØ§Ø­Ø¨Ù‡Ø§ ØªØ±Ùƒ Ø®Ù„ÙÙ‡ Ø°ÙƒØ±Ù‰ØŒ ÙˆØ§Ù„Ø¢Ù† Ø£Ù†Øª Ø¬Ø²Ø¡ Ù…Ù†Ù‡Ø§. Ø­Ø§ÙØ¸ Ø¹Ù„ÙŠÙ‡Ø§ Ù„ØªØ³ØªÙ…Ø± Ø§Ù„Ø­ÙƒØ§ÙŠØ©.
    </div>

    <div class="info-box"><strong>ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø±</strong> <span id="vName"></span></div>
    <div class="info-box"><strong>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</strong> <span id="vPhone"></span></div>
    <div class="info-box" id="vEmailBox" style="display:none;"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</strong> <span id="vEmail"></span></div>
    
    <button onclick="shareLink()">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø£Ø«Ø± âœ¨</button>
    <div class="visitor-count">Ø£Ù†Øª Ø§Ù„Ø´Ø®Øµ Ø±Ù‚Ù… <span id="visitNum">..</span> Ø§Ù„Ø°ÙŠ ÙŠÙ…Ø± Ù…Ù† Ù‡Ù†Ø§</div>
</div>

<div class="card" id="regCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    <form id="regForm">
        <input type="text" name="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *" required>
        <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *" required>
        <input type="text" name="itemCode" id="itemCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø·Ø¹Ø©" required>
        <button type="submit" id="subBtn">ØªØ®Ù„ÙŠØ¯ Ø§Ù„Ø£Ø«Ø±</button>
    </form>
</div>

<div class="controls">
    <div class="btn-circle" id="musicBtn" onclick="toggleMusic()">ğŸµ</div>
</div>

<audio id="bgMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-17.mp3" type="audio/mpeg">
</audio>

<script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxxphuMJvEQhUL4D7To3cRodLmXhRV3ngRGr0OwyaZnJo9TX-wPSXXtAujHiJGzaOn8/exec';
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');

    window.onload = () => {
        if (code) { fetch(`${webAppUrl}?read=${encodeURIComponent(code)}`).then(res => res.json()).then(data => { window.cachedData = data; }); }
        
        setTimeout(() => {
            document.getElementById('welcome-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcome-screen').style.display = 'none';
                renderUI();
            }, 800);
        }, 2500);
    };

    function renderUI() {
        if (window.cachedData && window.cachedData.name && window.cachedData.name !== "Not Found") {
            document.getElementById('vName').innerText = window.cachedData.name;
            document.getElementById('vPhone').innerText = window.cachedData.phone;
            document.getElementById('visitNum').innerText = Math.floor(Math.random() * 50) + 5; // Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¬Ù…Ø§Ù„ÙŠØ©
            showCard('displayCard');
        } else {
            document.getElementById('itemCode').value = code || '';
            showCard('regCard');
        }
    }

    function showCard(id) { document.getElementById(id).classList.add('active'); }

    // ØªØ£Ø«ÙŠØ± Ø§Ù„ØºØ¨Ø§Ø± ÙˆØ§Ù„Ù„Ù…Ø³
    const canvas = document.getElementById('chipCanvas');
    const ctx = canvas.getContext('2d');
    let w, h, particles = [];
    let mouse = { x: -100, y: -100 };

    window.onmousemove = (e) => { mouse.x = e.clientX; mouse.y = e.clientY; };
    window.ontouchmove = (e) => { mouse.x = e.touches[0].clientX; mouse.y = e.touches[0].clientY; };

    function init() {
        w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight;
        particles = []; for (let i = 0; i < 80; i++) particles.push(new Particle());
    }
    class Particle {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * w; this.y = Math.random() * h;
            this.size = Math.random() * 2;
            this.speedX = Math.random() * 0.5 - 0.25;
            this.speedY = Math.random() * 0.5 - 0.25;
        }
        update() {
            this.x += this.speedX; this.y += this.speedY;
            // Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù„Ù…Ø³/Ø§Ù„Ù…Ø§ÙˆØ³
            let dx = mouse.x - this.x;
            let dy = mouse.y - this.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            if(dist < 80) { this.x -= dx/20; this.y -= dy/20; }
            if (this.x < 0 || this.x > w || this.y < 0 || this.y > h) this.reset();
        }
        draw() {
            ctx.fillStyle = Math.random() > 0.5 ? '#2ecc71' : '#00f2ff';
            ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill();
        }
    }
    function animate() {
        ctx.clearRect(0, 0, w, h);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    init(); animate();

    // Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø£Ø«Ø±
    function shareLink() {
        if (navigator.share) {
            navigator.share({ title: 'Ø£Ø«ÙÙ€Ù€Ù€Ø±', text: 'Ø´Ø§Ù‡Ø¯ Ø£Ø«Ø± Ù‡Ø°Ø§ Ø§Ù„Ø´Ø®Øµ', url: window.location.href });
        } else {
            alert('Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡: ' + window.location.href);
        }
    }

    // Ù…ÙˆØ³ÙŠÙ‚Ù‰
    function toggleMusic() {
        const m = document.getElementById('bgMusic');
        if (m.paused) { m.play(); document.getElementById('musicBtn').innerText = 'â¸'; }
        else { m.pause(); document.getElementById('musicBtn').innerText = 'ğŸµ'; }
    }

    document.getElementById('regForm').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('subBtn').innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        fetch(webAppUrl, { method: 'POST', mode: 'no-cors', body: new URLSearchParams(new FormData(this)) })
        .then(() => { alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø«Ø±Ùƒ!'); location.reload(); });
    };
</script>
</body>
</html>

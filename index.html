<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«ÙÙ€Ù€Ù€Ø± | ATHAR LEGACY</title>
    <style>
        :root {
            --primary-color: #2ecc71;
            --secondary-color: #00f2ff;
            --bg-dark: #000000;
        }

        body { 
            margin: 0; background: var(--bg-dark); color: #fff; 
            font-family: 'Segoe UI', Tahoma, sans-serif; 
            overflow: hidden; display: flex; justify-content: center; align-items: center; min-height: 100vh; 
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100; display: flex; justify-content: center; align-items: center;
            transition: opacity 0.8s ease-in-out;
        }
        #welcome-text {
            font-size: 1.5rem; text-align: center; color: var(--primary-color);
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.6);
            padding: 15px; border-bottom: 2px solid var(--secondary-color);
            opacity: 0; animation: fadeInOut 2.8s forwards;
        }
        @keyframes fadeInOut { 0% { opacity: 0; transform: scale(0.9); } 30% { opacity: 1; transform: scale(1); } 70% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(1.05); } }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .card { 
            background: rgba(10, 25, 15, 0.95); 
            padding: 2rem; border-radius: 25px; 
            border: 2px solid var(--primary-color); 
            width: 85%; max-width: 360px; 
            z-index: 2; backdrop-filter: blur(15px);
            text-align: center; display: none; opacity: 0;
            transition: opacity 0.5s ease;
        }
        .card.active { display: block; opacity: 1; }

        h1 { margin: 0; font-size: 2.5rem; text-shadow: 0 0 10px var(--primary-color); }
        .tagline { color: var(--secondary-color); font-size: 0.7rem; letter-spacing: 4px; margin-bottom: 20px; }

        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ø«Ø± */
        .message-box {
            background: rgba(46, 204, 113, 0.1);
            padding: 12px; border-radius: 12px;
            margin-bottom: 15px; border-right: 4px solid var(--primary-color);
            font-size: 0.9rem; line-height: 1.5; color: #ddd;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px; margin: 10px 0; padding: 12px; text-align: right;
        }
        .info-box strong { color: var(--secondary-color); display: block; font-size: 0.75rem; }
        .info-box span { font-size: 1.1rem; }

        input {
            width: 100%; box-sizing: border-box; background: rgba(0,0,0,0.3);
            border: 1px solid var(--primary-color); padding: 12px; margin: 8px 0;
            border-radius: 10px; color: #fff; text-align: right;
        }

        button { 
            width: 100%; padding: 14px; margin-top: 10px;
            background: var(--primary-color); border: none; border-radius: 10px;
            color: #000; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

<div id="welcome-screen">
    <div id="welcome-text">ÙƒÙÙ„ Ù…Ø§ Ù†ØªØ±ÙƒÙ‡Ù Ø®Ù„ÙÙ†Ø§.. ÙŠÙØ­ÙŠÙŠÙ†Ø§</div>
</div>

<canvas id="chipCanvas"></canvas>

<div class="card" id="displayCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    
    <div class="message-box">
        Ù„Ù‚Ø¯ ÙˆØ¬Ø¯ØªÙ Ù‚Ø·Ø¹Ø© ØªØ­Ù…Ù„ <span style="color: var(--secondary-color);">Ø£Ø«Ø±Ø§Ù‹</span>.. 
        ØµØ§Ø­Ø¨Ù‡Ø§ ØªØ±Ùƒ Ø®Ù„ÙÙ‡ Ø°ÙƒØ±Ù‰ØŒ ÙˆØ§Ù„Ø¢Ù† Ø£Ù†Øª Ø¬Ø²Ø¡ Ù…Ù†Ù‡Ø§.
    </div>

    <div class="info-box"><strong>ØµØ§Ø­Ø¨ Ø§Ù„Ø£Ø«Ø±</strong> <span id="vName"></span></div>
    <div class="info-box"><strong>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</strong> <span id="vPhone"></span></div>
    
    <button onclick="location.reload()">ØªØ­Ø¯ÙŠØ« ğŸ”„</button>
</div>

<div class="card" id="regCard">
    <h1>Ø£Ø«ÙÙ€Ù€Ù€Ø±</h1>
    <div class="tagline">ATHAR LEGACY</div>
    <form id="regForm">
        <input type="text" name="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *" required>
        <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ *" required>
        <input type="text" name="itemCode" id="itemCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø·Ø¹Ø©" required>
        <button type="submit" id="subBtn">ØªØ®Ù„ÙŠØ¯ Ø§Ù„Ø£Ø«Ø±</button>
    </form>
</div>

<script>
    const webAppUrl = 'https://script.google.com/macros/s/AKfycbxxphuMJvEQhUL4D7To3cRodLmXhRV3ngRGr0OwyaZnJo9TX-wPSXXtAujHiJGzaOn8/exec';
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');

    window.onload = () => {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (code) {
            fetch(`${webAppUrl}?read=${encodeURIComponent(code)}`)
                .then(res => res.json())
                .then(data => { window.userData = data; });
        }

        setTimeout(() => {
            document.getElementById('welcome-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcome-screen').style.display = 'none';
                if (window.userData && window.userData.name && window.userData.name !== "Not Found") {
                    document.getElementById('vName').innerText = window.userData.name;
                    document.getElementById('vPhone').innerText = window.userData.phone;
                    document.getElementById('displayCard').classList.add('active');
                } else {
                    document.getElementById('itemCode').value = code || '';
                    document.getElementById('regCard').classList.add('active');
                }
            }, 800);
        }, 2800);
    };

    // Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¨Ø³ÙŠØ· Ù„Ù„Ø®Ù„ÙÙŠØ© (Ù…Ø³ØªÙ‚Ø±)
    const canvas = document.getElementById('chipCanvas');
    const ctx = canvas.getContext('2d');
    let w, h, particles = [];
    function init() {
        w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight;
        particles = []; for (let i = 0; i < 50; i++) particles.push({x:Math.random()*w, y:Math.random()*h, s:Math.random()*2});
    }
    function animate() {
        ctx.fillStyle = 'rgba(0,0,0,0.1)'; ctx.fillRect(0,0,w,h);
        ctx.fillStyle = '#2ecc71';
        particles.forEach(p => {
            ctx.fillRect(p.x, p.y, p.s, p.s);
            p.y += 0.5; if(p.y > h) p.y = 0;
        });
        requestAnimationFrame(animate);
    }
    init(); animate();

    document.getElementById('regForm').onsubmit = function(e) {
        e.preventDefault();
        document.getElementById('subBtn').innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        fetch(webAppUrl, { method: 'POST', mode: 'no-cors', body: new URLSearchParams(new FormData(this)) })
        .then(() => { alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø«Ø±Ùƒ!'); location.reload(); });
    };
</script>
</body>
</html>
